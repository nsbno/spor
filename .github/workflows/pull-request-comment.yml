name: Deploy to Test Environment
on:
  issue_comment:
    types:
      - created
  # Allow manual runs from the Actions UI or via `gh workflow run`
  workflow_dispatch:
    inputs:
      comment:
        description: "Simulate PR comment body (e.g. .deploy test or .preview)"
        required: false
        default: ""

jobs:
  deploy-to-test:
    if: (github.event_name == 'workflow_dispatch' && startsWith(github.event.inputs.comment || '', '.deploy')) || (github.event.issue.pull_request && startsWith(github.event.comment.body, '.deploy'))
    uses: nsbno/platform-actions/.github/workflows/deployment.branch-deploy.on-comment.yml@main
    secrets: inherit
    with:
      applications: digitalekanaler-designmanual
      working-directory: ./apps/designmanual-frontend
      terraform-directory: ./apps/designmanual-frontend

  preview-comment:
    if: ${{ (github.event_name == 'workflow_dispatch' && startsWith(github.event.inputs.comment || '', '.preview')) || (github.event.issue.pull_request && startsWith(github.event.comment.body, '.preview')) }}
    secrets: inherit
    uses: nsbno/platform-actions/.github/workflows/deployment.preview.on-comment.yml@main
    with:
      service-name: digitalekanaler-designmanual